<!doctype html>
<html lang="en" data-depth="0">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Bag | Garmin</title>
    <meta
      name="description"
      content="Review the items in your Garmin shopping bag."
    />
    <link rel="stylesheet" href="./styles/globals.css" />
    <link rel="stylesheet" href="./styles/navigation.css" />
    <link rel="stylesheet" href="./styles/footer.css" />
    <link rel="stylesheet" href="./styles/cart.css" />
  </head>

  <body class="page-light">
    <!-- Navigation Placeholder -->
    <div id="nav-root"></div>
    <div id="mega-root"></div>
    <div id="mobile-root"></div>

    <!-- Cart Page -->
    <main class="cart-page">
      <div class="cart-container">
        <h1 class="cart-title">Your Bag</h1>
        <p class="cart-subtitle" id="cartSubtitle">
          Free delivery and free returns.
        </p>
        <hr class="cart-divider" />

        <div class="cart-layout" id="cartLayout">
          <!-- Cart items and order summary rendered by JS -->
        </div>
      </div>
    </main>

    <!-- Footer Placeholder -->
    <div id="footer-root"></div>

    <!-- Scripts -->
    <script src="./scripts/shared-components.js"></script>
    <script src="./scripts/main.js"></script>
    <script src="./scripts/product-modal.js"></script>
    <script src="./scripts/cart.js"></script>

    <script>
      (function () {
        "use strict";

        function resolveAssetPath(relativePath) {
          const depth = parseInt(
            document.documentElement.getAttribute("data-depth") || "0",
            10,
          );
          const prefix = depth > 0 ? "../".repeat(depth) : "./";
          return prefix + relativePath.replace(/^\.\//, "");
        }

        function formatCurrency(amount) {
          return "₹" + amount.toLocaleString("en-IN");
        }

        function renderCart() {
          const layout = document.getElementById("cartLayout");
          const subtitle = document.getElementById("cartSubtitle");
          const items = GarminCart.getItems();

          if (items.length === 0) {
            subtitle.textContent = "Your bag is empty.";
            layout.innerHTML = `
              <div class="cart-empty">
                <svg class="cart-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <h2 class="cart-empty-title">Your bag is empty</h2>
                <p class="cart-empty-text">Explore our collection and find something you love.</p>
                <a href="${resolveAssetPath("./wearables.html")}" class="continue-shopping-btn">
                  Continue Shopping
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                </a>
              </div>
            `;
            return;
          }

          const count = GarminCart.getCount();
          const total = GarminCart.getTotal();
          subtitle.textContent = `Free delivery and free returns. ${count} item${count !== 1 ? "s" : ""} in your bag.`;

          let itemsHTML = '<div class="cart-items">';
          items.forEach((item) => {
            const imgPath = resolveAssetPath(item.image);
            const lineTotal = item.price * item.qty;
            itemsHTML += `
              <div class="cart-item" data-id="${item.id}">
                <div class="cart-item-image">
                  <img src="${imgPath}" alt="${item.title}" />
                </div>
                <div class="cart-item-info">
                  <div class="cart-item-title">${item.title}</div>
                  <div class="cart-item-subtitle">${item.eyebrow}</div>
                  <div class="qty-controls">
                    <button class="qty-btn qty-minus" data-id="${item.id}" ${item.qty <= 1 ? "disabled" : ""}>−</button>
                    <span class="qty-value">${item.qty}</span>
                    <button class="qty-btn qty-plus" data-id="${item.id}">+</button>
                  </div>
                </div>
                <div class="cart-item-controls">
                  <div class="cart-item-price">${formatCurrency(lineTotal)}</div>
                  <button class="cart-item-remove" data-id="${item.id}">Remove</button>
                </div>
              </div>
            `;
          });
          itemsHTML += "</div>";

          const summaryHTML = `
            <div class="order-summary">
              <h2 class="order-summary-title">Order Summary</h2>
              <div class="summary-row">
                <span class="summary-label">Subtotal</span>
                <span class="summary-value">${formatCurrency(total)}</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Shipping</span>
                <span class="summary-value free">FREE</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Estimated Tax</span>
                <span class="summary-value included">Included</span>
              </div>
              <hr class="summary-divider" />
              <div class="summary-row summary-total">
                <span class="summary-label">Total</span>
                <span class="summary-value">${formatCurrency(total)}</span>
              </div>
              <button class="checkout-btn" onclick="alert('Checkout coming soon!')">Checkout</button>
              <div class="trust-badges">
                <span class="trust-badge">Free delivery on all orders</span>
                <span class="trust-badge">30-day return policy</span>
              </div>
            </div>
          `;

          layout.innerHTML = itemsHTML + summaryHTML;
        }

        // Event delegation for qty and remove buttons
        document.addEventListener("click", (e) => {
          const minusBtn = e.target.closest(".qty-minus");
          if (minusBtn) {
            const id = minusBtn.dataset.id;
            const items = GarminCart.getItems();
            const item = items.find((i) => i.id === id);
            if (item && item.qty > 1) {
              GarminCart.updateQty(id, item.qty - 1);
              renderCart();
            }
            return;
          }

          const plusBtn = e.target.closest(".qty-plus");
          if (plusBtn) {
            const id = plusBtn.dataset.id;
            const items = GarminCart.getItems();
            const item = items.find((i) => i.id === id);
            if (item) {
              GarminCart.updateQty(id, item.qty + 1);
              renderCart();
            }
            return;
          }

          const removeBtn = e.target.closest(".cart-item-remove");
          if (removeBtn) {
            const id = removeBtn.dataset.id;
            const cartItem = removeBtn.closest(".cart-item");
            if (cartItem) {
              cartItem.style.transition = "all 0.3s ease";
              cartItem.style.opacity = "0";
              cartItem.style.transform = "translateX(-20px)";
              setTimeout(() => {
                GarminCart.remove(id);
                renderCart();
              }, 300);
            } else {
              GarminCart.remove(id);
              renderCart();
            }
            return;
          }
        });

        // Initial render
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", renderCart);
        } else {
          renderCart();
        }
      })();
    </script>
  </body>
</html>
